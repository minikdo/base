#!/bin/bash

set -u

MODE=${1:-nothing}

killall redshift

if [ $? = 0 ]; then

	if [ $MODE != "start" ]; then
	
		exit
	fi
fi
		
if [ $MODE = "start" ]; then

	TRIES=0
	
	while [ $TRIES -lt 5 ]; do
	
		ping -w3 -c1 8.8.8.8  > /dev/null 2>&1  
		
		if [ $? = 0 ]; then
		
			break
		fi

		sleep 5s
		
		TRIES=$(($TRIES+1))
	
	done

fi


COORDS="52:21"
IP=$(curl -m 5 -k https://139.162.172.22/ip.php )


if [ $? = 0 ]; then

	COORDS=$(/home/domino/bin/ipfilt $IP)

	if [ $? != 0 ]; then
		
		COORDS="52:21"
	fi
fi


exec redshift -l $COORDS

